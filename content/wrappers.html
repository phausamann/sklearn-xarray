

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Wrappers for sklearn estimators &mdash; sklearn-xarray 0.4.0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
        <script src="../_static/copybutton.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  <link rel="stylesheet" href="../_static/gallery.css" type="text/css" />
  <link rel="stylesheet" href="../_static/gallery-binder.css" type="text/css" />
  <link rel="stylesheet" href="../_static/gallery-dataframe.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Using coordinates as targets" href="target.html" />
    <link rel="prev" title="Installation" href="installation.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> sklearn-xarray
          

          
          </a>

          
            
            
              <div class="version">
                0.4.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="whatsnew.html">What’s New</a></li>
<li class="toctree-l1"><a class="reference internal" href="intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Wrappers for sklearn estimators</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#wrapping-estimators-for-dataarrays">Wrapping estimators for DataArrays</a></li>
<li class="toctree-l2"><a class="reference internal" href="#estimators-changing-the-shape-of-the-data">Estimators changing the shape of the data</a></li>
<li class="toctree-l2"><a class="reference internal" href="#accessing-fitted-estimators">Accessing fitted estimators</a></li>
<li class="toctree-l2"><a class="reference internal" href="#wrapping-estimators-for-datasets">Wrapping estimators for Datasets</a></li>
<li class="toctree-l2"><a class="reference internal" href="#wrapping-dask-ml-estimators">Wrapping dask-ml estimators</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="target.html">Using coordinates as targets</a></li>
<li class="toctree-l1"><a class="reference internal" href="pipeline.html">Pipelining and cross-validation</a></li>
<li class="toctree-l1"><a class="reference internal" href="transformers.html">Custom transformers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../auto_examples/index.html">General examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="api.html">API Reference</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">sklearn-xarray</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>Wrappers for sklearn estimators</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/content/wrappers.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="wrappers-for-sklearn-estimators">
<h1>Wrappers for sklearn estimators<a class="headerlink" href="#wrappers-for-sklearn-estimators" title="Permalink to this headline">¶</a></h1>
<p>sklearn-xarray provides wrappers that let you use sklearn estimators on
xarray DataArrays and Datasets. The goal is to provide a seamless integration
of both packages by only applying estimator methods on the raw data while
metadata (coordinates in xarray) remains untouched whereever possible.</p>
<p>There are two principal data types in xarray: <code class="docutils literal notranslate"><span class="pre">DataArray</span></code> and <code class="docutils literal notranslate"><span class="pre">Dataset</span></code>.
The wrappers provided in this package will determine automatically which
xarray type they’re dealing with when you call <code class="docutils literal notranslate"><span class="pre">fit</span></code> with either a
DataArray or a Dataset as your training data.</p>
<div class="section" id="wrapping-estimators-for-dataarrays">
<h2>Wrapping estimators for DataArrays<a class="headerlink" href="#wrapping-estimators-for-dataarrays" title="Permalink to this headline">¶</a></h2>
<p>First, we look at a basic example that shows how to wrap an estimator from
sklearn for use with a <code class="docutils literal notranslate"><span class="pre">DataArray</span></code>:</p>
<div class="highlight-pycon3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">sklearn_xarray</span> <span class="kn">import</span> <span class="n">wrap</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">sklearn_xarray.datasets</span> <span class="kn">import</span> <span class="n">load_dummy_dataarray</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">X</span> <span class="o">=</span> <span class="n">load_dummy_dataarray</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Xt</span> <span class="o">=</span> <span class="n">wrap</span><span class="p">(</span><span class="n">StandardScaler</span><span class="p">())</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
</pre></div>
</div>
<p>The <a class="reference internal" href="api/common.html#sklearn_xarray.wrap" title="sklearn_xarray.wrap"><code class="xref py py-func docutils literal notranslate"><span class="pre">wrap()</span></code></a> function will return an object with the corresponding
methods for each type of estimator (e.g. <code class="docutils literal notranslate"><span class="pre">predict</span></code> for classifiers and
regressors).</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>xarray references axes by name rather than by order. Therefore, you can
specify the <code class="docutils literal notranslate"><span class="pre">sample_dim</span></code> parameter of the wrapper to refer to the
dimension in your data that represents the samples. By default, the
wrapper will assume that the first dimension in the array is the sample
dimension.</p>
</div>
<p>When we run the example, we see that the data in the array is scaled, but the
coordinates and dimensions have not changed:</p>
<div class="highlight-pycon3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">X</span> 
<span class="go">&lt;xarray.DataArray (sample: 100, feature: 10)&gt;</span>
<span class="go">array([[ 0.565986,  0.196107,  0.935981, ...,  0.702356,  0.806494,  0.801178],</span>
<span class="go">       [ 0.551611,  0.277749,  0.27546 , ...,  0.646887,  0.616391,  0.227552],</span>
<span class="go">       [ 0.451261,  0.205744,  0.60436 , ...,  0.426333,  0.008449,  0.763937],</span>
<span class="go">       ...,</span>
<span class="go">       [ 0.019217,  0.112844,  0.894421, ...,  0.675889,  0.4957  ,  0.740349],</span>
<span class="go">       [ 0.542255,  0.053288,  0.483674, ...,  0.481905,  0.064586,  0.843511],</span>
<span class="go">       [ 0.607809,  0.425632,  0.702882, ...,  0.521591,  0.315032,  0.4258  ]])</span>
<span class="go">Coordinates:</span>
<span class="go">  * sample   (sample) int32 0 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 ...</span>
<span class="go">  * feature  (feature) int32 0 1 2 3 4 5 6 7 8 9</span>
</pre></div>
</div>
<div class="highlight-pycon3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">Xt</span> 
<span class="go">&lt;xarray.DataArray (sample: 100, feature: 10)&gt;</span>
<span class="go">array([[ 0.128639, -0.947769,  1.625452, ...,  0.525571,  1.07678 ,  1.062118],</span>
<span class="go">       [ 0.077973, -0.673463, -0.631625, ...,  0.321261,  0.408263, -0.942871],</span>
<span class="go">       [-0.275702, -0.91539 ,  0.492264, ..., -0.491108, -1.729624,  0.931952],</span>
<span class="go">       ...,</span>
<span class="go">       [-1.7984  , -1.227519,  1.483434, ...,  0.428084, -0.016158,  0.849506],</span>
<span class="go">       [ 0.045001, -1.427621,  0.079865, ..., -0.286418, -1.532214,  1.210086],</span>
<span class="go">       [ 0.27604 , -0.176596,  0.828923, ..., -0.140244, -0.651494, -0.249936]])</span>
<span class="go">Coordinates:</span>
<span class="go">  * sample   (sample) int32 0 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 ...</span>
<span class="go">  * feature  (feature) int32 0 1 2 3 4 5 6 7 8 9</span>
</pre></div>
</div>
</div>
<div class="section" id="estimators-changing-the-shape-of-the-data">
<h2>Estimators changing the shape of the data<a class="headerlink" href="#estimators-changing-the-shape-of-the-data" title="Permalink to this headline">¶</a></h2>
<p>Many sklearn estimators will change the number of features during
transformation or prediction. In this case, the coordinates along the feature
dimension no longer correspond to those of the original array. Therefore, the
wrapper will omit the coordinates along this dimension. You can specify which
dimension is changed with the <code class="docutils literal notranslate"><span class="pre">reshapes</span></code> parameter:</p>
<div class="highlight-pycon3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">sklearn.decomposition</span> <span class="kn">import</span> <span class="n">PCA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Xt</span> <span class="o">=</span> <span class="n">wrap</span><span class="p">(</span><span class="n">PCA</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="mi">5</span><span class="p">),</span> <span class="n">reshapes</span><span class="o">=</span><span class="s1">&#39;feature&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Xt</span> 
<span class="go">&lt;xarray.DataArray (sample: 100, feature: 5)&gt;</span>
<span class="go">array([[ 0.438773, -0.100947,  0.106754,  0.236872, -0.128751],</span>
<span class="go">       [-0.40433 , -0.580941,  0.588425, -0.305739, -0.120676],</span>
<span class="go">       [ 0.343535, -0.334365,  0.659667,  0.111196,  0.308099],</span>
<span class="go">       ...,</span>
<span class="go">       [ 0.519982,  0.38072 ,  0.133793, -0.064086,  0.108029],</span>
<span class="go">       [-0.099056, -0.086161, -0.115271, -0.053594, -0.736321],</span>
<span class="go">       [-0.358513, -0.327132, -0.635314, -0.310221, -0.017318]])</span>
<span class="go">Coordinates:</span>
<span class="go">  * sample   (sample) int32 0 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 ...</span>
<span class="go">Dimensions without coordinates: feature</span>
</pre></div>
</div>
</div>
<div class="section" id="accessing-fitted-estimators">
<h2>Accessing fitted estimators<a class="headerlink" href="#accessing-fitted-estimators" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">estimator</span></code> attribute of the wrapper will always hold the unfitted
estimator that was passed initially. After calling <code class="docutils literal notranslate"><span class="pre">fit</span></code> the fitted estimator
will be stored in the <code class="docutils literal notranslate"><span class="pre">estimator_</span></code> attribute:</p>
<div class="highlight-pycon3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">wrapper</span> <span class="o">=</span> <span class="n">wrap</span><span class="p">(</span><span class="n">StandardScaler</span><span class="p">())</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">wrapper</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
<span class="go">EstimatorWrapper(copy=True, estimator=StandardScaler(), with_mean=True,</span>
<span class="go">                 with_std=True)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">wrapper</span><span class="o">.</span><span class="n">estimator_</span><span class="o">.</span><span class="n">mean_</span> 
<span class="go">array([ 0.46156856,  0.47165326,  0.48397815,  0.48958361,  0.4730579 ,</span>
<span class="go">        0.522414  ,  0.46496134,  0.52299264,  0.48772645,  0.49043086])</span>
</pre></div>
</div>
<p>The wrapper also directly reflects the fitted attributes:</p>
<div class="highlight-pycon3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">wrapper</span><span class="o">.</span><span class="n">mean_</span> 
<span class="go">array([ 0.46156856,  0.47165326,  0.48397815,  0.48958361,  0.4730579 ,</span>
<span class="go">        0.522414  ,  0.46496134,  0.52299264,  0.48772645,  0.49043086])</span>
</pre></div>
</div>
</div>
<div class="section" id="wrapping-estimators-for-datasets">
<h2>Wrapping estimators for Datasets<a class="headerlink" href="#wrapping-estimators-for-datasets" title="Permalink to this headline">¶</a></h2>
<p>The syntax for Datasets is exactly the same as for DataArrays. Note that the
wrapper will fit one estimator for each variable in the Dataset. The fitted
estimators are stored in the attribute <code class="docutils literal notranslate"><span class="pre">estimator_dict_</span></code>:</p>
<div class="highlight-pycon3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">sklearn_xarray.datasets</span> <span class="kn">import</span> <span class="n">load_dummy_dataset</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">X</span> <span class="o">=</span> <span class="n">load_dummy_dataset</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">wrapper</span> <span class="o">=</span> <span class="n">wrap</span><span class="p">(</span><span class="n">StandardScaler</span><span class="p">())</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">wrapper</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
<span class="go">EstimatorWrapper(copy=True, estimator=StandardScaler(), with_mean=True,</span>
<span class="go">                 with_std=True)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">wrapper</span><span class="o">.</span><span class="n">estimator_dict_</span>
<span class="go">{&#39;var_1&#39;: StandardScaler()}</span>
</pre></div>
</div>
<p>The wrapper also directly reflects the fitted attributes as dictionaries with
one entry for each variable:</p>
<div class="highlight-pycon3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">wrapper</span><span class="o">.</span><span class="n">mean_</span><span class="p">[</span><span class="s1">&#39;var_1&#39;</span><span class="p">]</span> 
<span class="go">array([ 0.46156856,  0.47165326,  0.48397815,  0.48958361,  0.4730579 ,</span>
<span class="go">        0.522414  ,  0.46496134,  0.52299264,  0.48772645,  0.49043086])</span>
</pre></div>
</div>
</div>
<div class="section" id="wrapping-dask-ml-estimators">
<h2>Wrapping dask-ml estimators<a class="headerlink" href="#wrapping-dask-ml-estimators" title="Permalink to this headline">¶</a></h2>
<p>The <a class="reference external" href="http://dask-ml.readthedocs.io/en/latest/index.html">dask-ml</a> package re-implements a number of scikit-learn estimators for
use with <a class="reference external" href="http://dask.pydata.org/en/latest/">dask</a> on-disk arrays. You can wrap these estimators in the same way
in order to work with dask-backed DataArrays and Datasets:</p>
<div class="highlight-pycon3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">dask_ml.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">xarray</span> <span class="k">as</span> <span class="nn">xr</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">dask.array</span> <span class="k">as</span> <span class="nn">da</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">X</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">da</span><span class="o">.</span><span class="n">from_array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">((</span><span class="mi">100</span><span class="p">,</span> <span class="mi">10</span><span class="p">)),</span> <span class="n">chunks</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">)),</span>
<span class="gp">... </span>    <span class="n">coords</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;sample&#39;</span><span class="p">:</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span> <span class="s1">&#39;feature&#39;</span><span class="p">:</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)},</span>
<span class="gp">... </span>    <span class="n">dims</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;sample&#39;</span><span class="p">,</span> <span class="s1">&#39;feature&#39;</span><span class="p">)</span>
<span class="gp">... </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Xt</span> <span class="o">=</span> <span class="n">wrap</span><span class="p">(</span><span class="n">StandardScaler</span><span class="p">())</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">type</span><span class="p">(</span><span class="n">Xt</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
<span class="go">&lt;class &#39;dask.array.core.Array&#39;&gt;</span>
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="target.html" class="btn btn-neutral float-right" title="Using coordinates as targets" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="installation.html" class="btn btn-neutral float-left" title="Installation" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, Peter Hausamann

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>